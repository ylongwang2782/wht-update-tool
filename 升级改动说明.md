# wht_upgrade_tool改动说明

## 主要修改内容

### 1. 删除文件接收功能
- 删除了UI中的文件接收相关组件
- 删除了YmodemFileReceive相关的头文件和源文件
- 移除了widget.h和widget.cpp中接收相关的代码
- 更新了CMakeLists.txt和.pro文件

### 2. 功能重命名
- 将"文件发送"更名为"固件升级"
- 将"发送"按钮更名为"开始升级"
- 将"文件路径"更名为"固件路径"
- 将"传输进度"更名为"升级进度"
- 更新窗口标题为"wht_upgrade_tool"

### 3. 扩展升级逻辑
- 在开始升级时，首先发送"upgrade"命令给MCU
- 等待MCU进入bootloader模式并发送'C'字符
- 收到'C'字符后开始YMODEM固件传输
- 添加10秒超时机制，防止MCU无响应
- 支持取消等待bootloader的操作

### 4. 文件日志系统
- 添加了完整的文件日志功能
- 日志文件命名格式：upgrade_log_YYYYMMDD_HHMMSS.txt
- 记录所有关键操作和状态变化
- 不在界面显示调试信息，保持界面简洁
- 日志包含时间戳和详细的操作记录

## 文件修改列表

### 已修改的文件
- `widget.h` - 添加日志系统成员变量和方法
- `widget.cpp` - 主要逻辑修改和日志系统实现
- `widget.ui` - UI界面更新
- `CMakeLists.txt` - 移除YmodemFileReceive文件引用
- `wht_upgrade_tool.pro` - 移除YmodemFileReceive文件引用

### 已删除的文件
- `YmodemFileReceive.h`
- `YmodemFileReceive.cpp`

## 升级流程

1. 用户选择固件文件
2. 打开串口
3. 点击"开始升级"
4. 程序发送"upgrade"命令
5. 等待MCU响应'C'字符（10秒超时）
6. 收到'C'后启动YMODEM传输
7. 显示升级进度
8. 完成后提示结果

## 日志文件内容

日志文件包含以下信息：
- 程序启动时间
- 串口操作（打开/关闭）
- 固件文件选择
- 升级命令发送
- MCU响应监听
- YMODEM传输状态
- 错误和异常情况

所有操作都带有精确的时间戳，便于问题调试和追踪。
